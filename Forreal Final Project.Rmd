---
title: "Real Final Project"
author: "Isaac Freeman"
date: "12/5/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list = ls()) #cleanup
```

```{r}
library(mosaic)
library(tidyverse)
library(dplyr)
library(data.table)
library(ggpubr)
library(ggplot2) #Download Packages
```

```{r}
NFLDataset <- "/Users/isaacfreeman/Downloads/spreadspoke_scores.csv"

NFLDataTableOriginal <-
  data.table::fread(NFLDataset) #Upload Dataset
```

```{r}
View(NFLDataTableOriginal)
```
I needed to create a new variable to use for later analysis that has the point total from each game, so I added together the home score and the away score and called this variable "totalpoints".
```{r}
NFLDataTable <-
  NFLDataTableOriginal %>%
  mutate(totalpoints = score_away + score_home) #Create Variable "totalpoints"
View(NFLDataTable)
```
I was working with a huge dataset, so since a lot of my analysis is based on over/unders, I filtered out games without an over/under or totalpoints.
```{r}
NFLDataTable <-
NFLDataTable %>%
  na.omit(over_under_line) #Filter out games without over/under or totalpoints
NFLDataTable <-
NFLDataTable %>%
  na.omit(totalpoints)
View(NFLDataTable)
```
My dataset was still quite massive and messy to work with, so I chose to just look at the last 5 seasons, and selected only seasons 2013 and later.
```{r}
NFLDataTable <-
  NFLDataTable %>%
  filter(schedule_season >= 2013) #Filter Out Seasons prior to 2013
View(NFLDataTable)
```
I was curious how accurate the over/under predictions actually are, so I plotted the over/unders for each game against the total number of points that were scored in that game.  I also separated the graphs between playoff and regular season games to see if there was a difference in the correlation there.
```{r}
ggscatter(NFLDataTable, x = "over_under_line", y = "totalpoints", 
          add = "reg.line", conf.int = FALSE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Over/Under", ylab = "Total Points Scored") +
            aes(color = schedule_playoff) + facet_wrap(~schedule_playoff) #Test Correlation Between Over/Under and Total Points Scored
```
As shown in the graph above, there is (unsurprisingly) a positive correlation between over/unders and total points scored, but interestingly, the correlation is substantially stronger in the playoffs compared to regular season games.

I also wanted to check for a correlation between temperature and total points scored.  I figured that there would be a positive correlation, since it becomes harder to throw and catch the ball as it gets colder, but I didn't expect to see a very strong correlation.
```{r}
ggscatter(NFLDataTable, x = "weather_temperature", y = "totalpoints", 
          add = "reg.line", conf.int = FALSE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Temperature (F)", ylab = "Total Points Scored") +
            aes(color = schedule_playoff) + facet_wrap(~schedule_playoff) #Test Correlation Between Temperature and Total Points Scored
```
I was very shocked to find that there was actually a slight negative correlation between the variables during the regular season (although it was so close to 0 that it was essentially negligent).  In the playoffs, however, there was a low positive correlation there as shown in the graphs above.

I was curious what the average number of points scored per NFL game has been over the past 5 years.  Judging by my previous graphs, I figured it would be somewhere between 40 and 50.

```{r}
mean(as.vector(NFLDataTable$totalpoints))
```
I calculated the exact value to be 42.44824, right around what I was expecting.

I was also curious what the distribution of number of points scored per game looked like, although I guessed it would be approximately normal.
```{r}
NFLDataTable %>%
  ggplot(aes(x = totalpoints)) + 
  geom_density(fill = "turquoise", adjust = 2) +
  facet_wrap(~schedule_playoff)
```
Upon graphing it, I found that it was indeed approximately normal, with a center at around 40 points for regular season games and closer to 50 for playoff games.

Since I didn't find much of a correlation between points and temperature, I wondered if maybe it was the wind speed that had more of an effect on scores.  To test this, I only compared games that had wind speeds higher than 0 mph, because I wanted to see if there was a correlation, and the high proportion of games in domes would probably skew my numbers.

```{r}
NFLDataTableWindy <-
  NFLDataTable %>%
  filter(weather_wind_mph > 0) #Filter out games with wind speeds of 0
```

```{r}
NFLDataTableWindy %>%
  ggplot(aes(x = weather_wind_mph, y = totalpoints, color = schedule_playoff)) + stat_smooth() + geom_point(alpha = 0)
```
We can see a more clear negative trend here, especially in the playoff games, that higher wind speeds result in lower point totals.  But again, it is very subtle.  This lack of a strong correlation has been very eye-opening to me considering the weekly advice from fantasy football "experts" that says to avoid playing players in cold or windy conditions.
